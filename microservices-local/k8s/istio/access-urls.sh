#!/bin/bash

echo "ğŸŒ Microservices Access URLs"
echo "============================"

# Get gateway port
GATEWAY_PORT=$(kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.spec.ports[?(@.name=="http2")].nodePort}')

echo "ğŸ“Š Available Services and URLs:"
echo ""
echo "ğŸ”— Istio Gateway (HTTP): http://localhost:$GATEWAY_PORT"
echo "   - Host header required: microservices.local"
echo ""
echo "ğŸª Product Service:"
echo "   - Direct: http://localhost:30000 (via API Gateway)"
echo "   - Via Istio: http://localhost:$GATEWAY_PORT/product/health"
echo "   - Headers: -H 'Host: microservices.local'"
echo ""
echo "ğŸ“¦ Order Service:"
echo "   - Direct: http://localhost:30003"
echo "   - Via Istio: http://localhost:$GATEWAY_PORT/order/health"
echo "   - Headers: -H 'Host: microservices.local'"
echo ""
echo "ğŸ–¥ï¸  Frontend:"
echo "   - Direct: http://localhost:30080"
echo "   - Via Istio: http://localhost:$GATEWAY_PORT/"
echo "   - Headers: -H 'Host: frontend.local'"
echo ""
echo "ğŸ” Auth Service:"
echo "   - Direct: http://localhost:30001"
echo ""
echo "ğŸŒŸ API Gateway:"
echo "   - Direct: http://localhost:30000"
echo "   - Via Istio: http://localhost:$GATEWAY_PORT/api/"
echo "   - Headers: -H 'Host: microservices.local'"
echo ""
echo "ğŸ“ˆ Kiali Dashboard: http://localhost:20001"
echo "ğŸ“Š Grafana Dashboard: http://localhost:3000"
echo "ğŸ” Jaeger Tracing: http://localhost:16686"
echo ""
echo "ğŸ§ª Quick Tests:"
echo "curl -H 'Host: microservices.local' http://localhost:$GATEWAY_PORT/product/health"
echo "curl -H 'Host: microservices.local' http://localhost:$GATEWAY_PORT/order/health"
echo "curl http://localhost:30003/health"
echo "curl http://localhost:30080"
